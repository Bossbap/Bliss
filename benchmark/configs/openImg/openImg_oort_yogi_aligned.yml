# Configuration file for OpenImg + ShuffleNetV2 (Oort + YoGi), aligned with Oort paper

# ========== Cluster configuration ========== 
ps_ip: 129.104.252.32

worker_ips:
    - 129.104.252.32:[3]
    - 129.104.252.34:[4]
    - 129.104.252.39:[4]
    - 129.104.252.43:[4]
    - 129.104.252.49:[4]
    - 129.104.252.45:[4]
    - 129.104.252.53:[4]

exp_path: /users/eleves-a/2024/baptiste.geisenberger/FedScale/fedscale/cloud

executor_entry: execution/executor.py
aggregator_entry: aggregation/aggregator.py

auth:
    ssh_user: "baptiste.geisenberger"
    ssh_private_key: "/users/eleves-a/2024/baptiste.geisenberger/.ssh/id_rsa"

setup_commands:
    - source /Data/baptiste.geisenberger/miniconda3/bin/activate fedscale

# ========== Job configuration ========== 
job_conf:
    - job_name: openimage_oort_yogi
    - task: cv
    - model: shufflenet_v2_x2_0
    - model_zoo: torchcv
    - num_classes: 596
    - data_set: openImg
    - data_dir: /Data/baptiste.geisenberger/Data/openImg
    - data_map_file: /Data/baptiste.geisenberger/Data/openImg/client_data_mapping/train.csv
    - clients_file: /users/eleves-a/2024/baptiste.geisenberger/FedScale/benchmark/dataset/data/clients.pkl
    - log_path: /users/eleves-a/2024/baptiste.geisenberger/FedScale/benchmark

    # Preprocessing: use Oort-style 96x96 by default (config_parser default); set to 256 to revert
    - openimg_size: 96

    - use_cuda: True
    - num_loaders: 2
    - clock_factor: 30

    # Optimizer / sampling
    - sample_mode: oort
    - gradient_policy: fed-yogi
    - yogi_eta: 0.003
    - yogi_tau: 1e-8
    - yogi_beta: 0.9
    - yogi_beta2: 0.99

    # Core FL hyperparams (aligned with Oort)
    - num_participants: 100
    - rounds: 500
    - eval_interval: 20
    - local_steps: 20
    - batch_size: 20
    - filter_less: 32
    - test_bsz: 20

    - learning_rate: 0.04
    - decay_factor: 0.95
    - decay_round: 5
    - weight_decay: 5e-4

    # Oort knobs
    - pacer_delta: 10
    - pacer_step: 20
    - exploration_alpha: 0.3
    - exploration_factor: 0.9
    - exploration_decay: 0.98
    - exploration_min: 0.2
    - sample_window: 20
    - round_penalty: 2.0
    - round_threshold: 10
    - blacklist_rounds: -1
    - overcommitment: 1.3
